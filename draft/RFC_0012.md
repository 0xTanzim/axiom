# RFC-0012: Logging Integration (SLF4J)

**Status:** Draft
**Priority:** P0 (Production Requirement)
**Target Java:** 25 LTS
**Dependencies:** SLF4J 2.x

---

## 1. Motivation

Axiom currently uses `System.err.println()` for error output. This is:

- ❌ Not production-ready
- ❌ Not configurable
- ❌ No log levels
- ❌ No structured output
- ❌ No request correlation

Every production Java application needs proper logging. Users expect:

```java
private static final Logger log = LoggerFactory.getLogger(MyService.class);

log.info("Processing request: {} {}", method, path);
log.error("Failed to handle request", exception);
```

---

## 2. Design Principle

> **Use the industry standard. Don't reinvent.**

SLF4J is the universal Java logging facade. Every major library uses it:
- Spring Boot
- Hibernate
- Jackson
- Apache Commons

Axiom will use SLF4J API. Users provide the implementation.

---

## 3. User Experience

### 3.1 Minimal Setup (Zero Config)

```xml
<!-- User's pom.xml -->
<dependency>
    <groupId>io.axiom</groupId>
    <artifactId>axiom-core</artifactId>
</dependency>

<!-- Optional: Add logging implementation -->
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
</dependency>
```

If no implementation provided, SLF4J uses NOP logger (silent).
If Logback provided, logging works automatically.

### 3.2 What Users See

```
2026-01-17 10:30:15.123 INFO  [main] io.axiom.core.app.DefaultApp - Server starting
2026-01-17 10:30:15.456 INFO  [main] io.axiom.server.JdkServer - Listening on 0.0.0.0:8080
2026-01-17 10:30:15.789 INFO  [main] io.axiom.core.app.DefaultApp - Server ready

2026-01-17 10:30:20.123 DEBUG [vt-1] io.axiom.core.app.DefaultApp - GET /users/123
2026-01-17 10:30:20.456 DEBUG [vt-1] io.axiom.core.routing.Router - Matched route: /users/:id
```

### 3.3 Request Correlation (MDC)

```java
// Axiom automatically sets MDC for each request
// User can access in their code

log.info("Processing user request");
// Output: 2026-01-17 10:30:20 INFO [req-abc123] Processing user request
```

---

## 4. Internal Changes

### 4.1 Add SLF4J Dependency

```xml
<!-- axiom-core/pom.xml -->
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>2.0.9</version>
</dependency>
```

### 4.2 Replace System.err with Logger

**Before (current):**
```java
System.err.println("Ready hook failed: " + e.getMessage());
```

**After:**
```java
private static final Logger LOG = LoggerFactory.getLogger(DefaultApp.class);

LOG.warn("Ready hook failed: {}", e.getMessage(), e);
```

### 4.3 Logging Points in Framework

| Component | Log Level | What's Logged |
|-----------|-----------|---------------|
| DefaultApp | INFO | Startup, shutdown, state transitions |
| DefaultApp | WARN | Hook failures, non-fatal errors |
| DefaultApp | ERROR | Fatal errors, unhandled exceptions |
| DefaultApp | DEBUG | Request start/end |
| Router | DEBUG | Route matching |
| JdkServer | INFO | Server start/stop |
| JdkServer | DEBUG | Connection events |
| Middleware | TRACE | Middleware execution order |

### 4.4 MDC Integration

```java
// In JdkServer.handleExchange()
String requestId = UUID.randomUUID().toString().substring(0, 8);
MDC.put("requestId", requestId);
try {
    handler.handle(context);
} finally {
    MDC.clear();
}
```

Users can configure log pattern to include `%X{requestId}`.

---

## 5. Module Changes

### 5.1 module-info.java

```java
module io.axiom.core {
    requires org.slf4j;  // Add this

    // ... existing exports
}
```

### 5.2 Files to Modify

| File | Change |
|------|--------|
| `DefaultApp.java` | Replace System.err with Logger |
| `JdkServer.java` | Add request logging, MDC |
| `Router.java` | Add debug logging for matching |
| `MiddlewareAdapter.java` | Add trace logging |

---

## 6. Configuration (User Side)

### 6.1 Logback Example (logback.xml)

```xml
<configuration>
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} %-5level [%thread] [%X{requestId}] %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Axiom framework logs -->
    <logger name="io.axiom" level="INFO"/>

    <!-- Debug routing -->
    <logger name="io.axiom.core.routing" level="DEBUG"/>

    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
    </root>
</configuration>
```

### 6.2 JSON Logging (Production)

```xml
<appender name="JSON" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
</appender>
```

---

## 7. Best Practices Enforced

1. **No string concatenation in log statements**
   ```java
   // BAD
   log.debug("User: " + userId);

   // GOOD
   log.debug("User: {}", userId);
   ```

2. **Include exception as last argument**
   ```java
   log.error("Failed to process request: {}", path, exception);
   ```

3. **Use appropriate log levels**
   - ERROR: Something failed, needs attention
   - WARN: Unexpected but handled
   - INFO: Notable events (startup, shutdown)
   - DEBUG: Detailed flow information
   - TRACE: Very detailed, usually framework internals

---

## 8. Testing

### 8.1 Test with SLF4J-Test

```java
@Test
void shouldLogStartup() {
    TestLogger logger = TestLoggerFactory.getTestLogger(DefaultApp.class);

    App app = Axiom.create();
    app.listen(0);
    app.stop();

    assertThat(logger.getLoggingEvents())
        .extracting(LoggingEvent::getMessage)
        .contains("Server starting", "Server ready");
}
```

---

## 9. Migration Path

### Phase 1: Add SLF4J to axiom-core
- Add dependency
- Update module-info
- Create logger constants

### Phase 2: Replace System.err
- DefaultApp: All lifecycle logging
- JdkServer: Server events
- Error handling: Exception logging

### Phase 3: Add MDC
- Request ID generation
- MDC population/cleanup
- Document log patterns

---

## 10. Non-Goals

- ❌ Custom logging API
- ❌ Built-in log appenders
- ❌ Log file management
- ❌ Log rotation

These are handled by the user's chosen SLF4J implementation (Logback, Log4j2).

---

## 11. Compatibility

| SLF4J Implementation | Supported |
|---------------------|-----------|
| Logback Classic | ✅ Recommended |
| Log4j2 SLF4J | ✅ Supported |
| SLF4J Simple | ✅ Dev only |
| SLF4J NOP | ✅ Silent |
| JUL (java.util.logging) | ✅ Via bridge |

---

## 12. Summary

- Use SLF4J 2.x as logging facade
- Users provide implementation (Logback recommended)
- Framework logs at appropriate levels
- MDC provides request correlation
- Zero config to start, full control available

**This is standard Java logging. No reinvention.**
