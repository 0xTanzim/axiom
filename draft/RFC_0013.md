
# RFC-0013: Unified Configuration System (DX-First)

**Status:** Draft
**Priority:** P1 (Foundational)
**Target Java:** 21+ (25 LTS ready)
**Module:** `axiom-config`
**Audience:** Framework users & contributors

---

## 1. Purpose

This RFC defines a **single, unified configuration system** for Axiom that:

- Feels effortless for beginners
- Scales cleanly to production and cloud
- Supports all common configuration sources
- Is explicit, predictable, and type-safe
- Avoids Spring-style hidden injection

---

## 2. Design Goal (North Star)

> **One configuration system. One mental model. Zero surprises.**

Axiom configuration must:
- Work out of the box
- Fail fast on mistakes
- Be environment-aware
- Require no framework knowledge to use

---

## 3. Core Principles (LOCKED)

1. **Explicit over magic**
2. **Convention over configuration**
3. **Fail fast at startup**
4. **Type-safe by default**
5. **Immutable after load**
6. **No runtime injection**
7. **One global config tree**

---

## 4. User Mental Model

From the user’s perspective:

> “Axiom reads config from `.env`, environment variables, system properties,
> and `application.properties`, merges them deterministically,
> and binds them to Java records.”

Nothing else.

---

## 5. Supported Configuration Sources

Axiom automatically discovers and loads configuration from **all standard sources**.

### 5.1 Source Priority (Highest → Lowest)

```

1. Programmatic overrides
2. JVM system properties (-Dkey=value)
3. Environment variables
4. .env file
5. application-{profile}.properties
6. application.properties

```

Higher priority **always overrides** lower priority.

This order is fixed and documented.

---

## 6. `.env` Support (YES, FIRST-CLASS)

### 6.1 Why `.env` is supported

- Standard in modern dev workflows
- Common in Docker & local dev
- Expected by users

### 6.2 `.env` Rules (Important)

- `.env` is **optional**
- Loaded only from project root
- Parsed as simple `KEY=VALUE`
- Loaded **before** real environment variables
- **Never overrides** real env vars

### Example `.env`

```

AXIOM_PROFILE=dev
AXIOM_SERVER_PORT=8081
DB_PASSWORD=secret

```

`.env` behaves as a **local env fallback**, nothing more.

---

## 7. Multi-Environment (Profiles)

### 7.1 Profile Resolution Order

```

1. Programmatic override
2. AXIOM_PROFILE env var
3. -Daxiom.profile JVM property
4. default (no profile)

```

### 7.2 File Resolution

If profile is `dev`, Axiom loads:

```

application.properties
application-dev.properties

````

Later files override earlier ones.

Rules:
- No nested profiles
- No profile inheritance
- No surprises

---

## 8. Naming Conventions

### 8.1 Properties Keys

```properties
axiom.server.port=8080
axiom.server.host=0.0.0.0

axiom.datasource.url=jdbc:postgresql://localhost/app
axiom.datasource.username=app
axiom.datasource.password=${DB_PASSWORD}

app.feature.enabled=true
````

---

### 8.2 Environment Variable Mapping

```
axiom.server.port             → AXIOM_SERVER_PORT
axiom.datasource.pool.size    → AXIOM_DATASOURCE_POOL_SIZE
```

Rules:

* Dots (`.`) → underscores (`_`)
* Uppercase
* Flat mapping

---

## 9. Public API

### 9.1 `Config` Interface

```java
public interface Config {

    Optional<String> get(String key);

    String get(String key, String defaultValue);

    int getInt(String key, int defaultValue);

    long getLong(String key, long defaultValue);

    boolean getBoolean(String key, boolean defaultValue);

    Duration getDuration(String key, Duration defaultValue);

    Config subset(String prefix);

    <T> T bind(Class<T> type);
}
```

---

## 10. Type-Safe Binding (Record-First)

### 10.1 Recommended Pattern

```java
@ConfigPrefix("axiom.server")
public record ServerConfig(
    int port,
    String host,
    int backlog
) {
    public ServerConfig {
        if (port <= 0) {
            throw new ConfigException("Invalid server port");
        }
    }
}
```

Usage:

```java
Config config = AxiomConfig.load();
ServerConfig server = config.bind(ServerConfig.class);
```

No `subset()` required.
Zero boilerplate.

---

## 11. Binding Rules (All Edge Cases Covered)

### Rule 1: Missing Properties

* If record provides a default → use it
* Otherwise → **startup fails**

### Rule 2: Type Mismatch

* No silent coercion
* Fail fast with clear error

### Rule 3: Unknown Properties

* Ignored by default
* Optional strict mode for validation

### Rule 4: Validation

* Performed in record constructor
* Any exception aborts startup

---

## 12. Programmatic Overrides (Advanced Users)

```java
Config config = AxiomConfig.builder()
    .fromClasspath("application.properties")
    .fromDotEnv()
    .fromEnv()
    .fromSystemProperties()
    .set("axiom.server.port", "9090")
    .build();
```

Programmatic values **always win**.

---

## 13. Framework Integration (DX-First)

### 13.1 Zero-Config Startup

```java
Axiom.start();
```

Internally:

* Loads config
* Binds server + persistence configs
* Starts application

---

### 13.2 Advanced Startup

```java
Axiom.create()
    .config(AxiomConfig.load())
    .start();
```

---

## 14. Error Handling (Fail Fast)

All configuration errors:

* Occur at startup
* Abort application
* Show exact source and key

### Example Error

```
Missing required property: axiom.datasource.url
Active profile: prod
Sources checked:
- env
- .env
- application.properties
- application-prod.properties
```

---

## 15. Thread Safety & Lifecycle

* Config is immutable
* Loaded once at startup
* Safe to share across threads
* No runtime mutation

---

## 16. Module Placement

### New Module: `axiom-config`

```
axiom-config/
├── Config.java
├── AxiomConfig.java
├── loader/
│   ├── PropertiesLoader
│   ├── ProfileLoader
│   ├── DotEnvLoader
│   ├── EnvLoader
│   └── SystemPropertyLoader
└── bind/
    └── RecordBinder
```

All other modules depend on this.

---

## 17. Non-Goals (Intentional)

* YAML / JSON / TOML
* Hot reload
* Encrypted config
* Annotation-based injection
* Dynamic reconfiguration

Use external secret managers when needed.

---

## 18. Final Guarantee (LOCKED)

> **Axiom configuration is explicit, predictable, environment-aware,
> type-safe, and boring — exactly what production systems need.**

---

## 19. TL;DR

* `.env` ✅
* `application.properties` ✅
* `application-{profile}.properties` ✅
* env vars ✅
* system props ✅
* type-safe records ✅
* fail fast ✅
* zero-config DX ✅

```
